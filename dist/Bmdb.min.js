!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("jQuery")):"function"==typeof define&&define.amd?define("Bmdb",["jQuery"],n):"object"==typeof exports?exports.Bmdb=n(require("jQuery")):t.Bmdb=n(t.jQuery)}(window,function(t){return function(t){var n={};function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:i})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var r in t)e.d(i,r,function(n){return t[n]}.bind(null,r));return i},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="/",e(e.s=19)}([function(n,e){n.exports=t},function(t,n){t.exports=function(t){var n=typeof t;return null!=t&&("object"==n||"function"==n)}},function(t,n,e){var i=e(10),r="object"==typeof self&&self&&self.Object===Object&&self,o=i||r||Function("return this")();t.exports=o},function(t,n){var e;e=function(){return this}();try{e=e||new Function("return this")()}catch(t){"object"==typeof window&&(e=window)}t.exports=e},function(t,n,e){var i=e(2).Symbol;t.exports=i},function(t,n,e){"use strict";t.exports=e(17)},function(t,n,e){var i=e(1),r=e(9),o=e(11),s="Expected a function",a=Math.max,c=Math.min;t.exports=function(t,n,e){var u,l,f,d,b,p,v=0,h=!1,m=!1,y=!0;if("function"!=typeof t)throw new TypeError(s);function g(n){var e=u,i=l;return u=l=void 0,v=n,d=t.apply(i,e)}function x(t){var e=t-p;return void 0===p||e>=n||e<0||m&&t-v>=f}function j(){var t=r();if(x(t))return w(t);b=setTimeout(j,function(t){var e=n-(t-p);return m?c(e,f-(t-v)):e}(t))}function w(t){return b=void 0,y&&u?g(t):(u=l=void 0,d)}function $(){var t=r(),e=x(t);if(u=arguments,l=this,p=t,e){if(void 0===b)return function(t){return v=t,b=setTimeout(j,n),h?g(t):d}(p);if(m)return clearTimeout(b),b=setTimeout(j,n),g(p)}return void 0===b&&(b=setTimeout(j,n)),d}return n=o(n)||0,i(e)&&(h=!!e.leading,f=(m="maxWait"in e)?a(o(e.maxWait)||0,n):f,y="trailing"in e?!!e.trailing:y),$.cancel=function(){void 0!==b&&clearTimeout(b),v=0,u=p=l=b=void 0},$.flush=function(){return void 0===b?d:w(r())},$}},function(t,n,e){var i=e(5);t.exports=function(t){"use strict";t=t||{};var n="",e=i.$each,r=t.skeletons;t.$value,t.$index;return n+='<div class="bmdb-list"><ul class="bmdb-ul"></ul></div><div class="bmdb-loader"><ul class="bmdb-ul"> ',e(r,function(t,e){n+=' <li class="bmdb-li"><div class="bmdb-cover"></div><div class="bmdb-title"></div><div class="bmdb-rank"></div></li> '}),n+=" </ul></div>"}},function(t,n,e){var i=e(5);t.exports=function(t){"use strict";t=t||{};var n="",e=i.$each,r=t.data,o=(t.$value,t.$index,i.$escape);t.starValue;return e(r,function(t,i){n+=' <li class="bmdb-li"><a href="',n+=o(t.doubanUrl),n+='" class="bmdb-link" target="_blank"><div class="bmdb-cover"><img class="bmdb-cover-image" src="',n+=o(t.cover),n+='" alt="',n+=o(t.title),n+='" width="150" height="220"></div><div class="bmdb-info"><div class="bmdb-title">',n+=o(t.title),n+='</div><div class="bmdb-rank"><span class="bmdb-rank-span bmdb-stars"> ',e(t.stars,function(t,e){n+=" ",n+=t?' <span class="bmdb-star bmdb-star-full"></span> ':' <span class="bmdb-star bmdb-star-gray"></span> ',n+=" "}),n+=' </span><span class="bmdb-rank-span">',n+=o(t.rating),n+="</span></div></div></a></li> "}),n}},function(t,n,e){var i=e(2);t.exports=function(){return i.Date.now()}},function(t,n,e){(function(n){var e="object"==typeof n&&n&&n.Object===Object&&n;t.exports=e}).call(this,e(3))},function(t,n,e){var i=e(1),r=e(12),o=NaN,s=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,u=/^0o[0-7]+$/i,l=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(r(t))return o;if(i(t)){var n="function"==typeof t.valueOf?t.valueOf():t;t=i(n)?n+"":n}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(s,"");var e=c.test(t);return e||u.test(t)?l(t.slice(2),e?2:8):a.test(t)?o:+t}},function(t,n,e){var i=e(13),r=e(16),o="[object Symbol]";t.exports=function(t){return"symbol"==typeof t||r(t)&&i(t)==o}},function(t,n,e){var i=e(4),r=e(14),o=e(15),s="[object Null]",a="[object Undefined]",c=i?i.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?a:s:c&&c in Object(t)?r(t):o(t)}},function(t,n,e){var i=e(4),r=Object.prototype,o=r.hasOwnProperty,s=r.toString,a=i?i.toStringTag:void 0;t.exports=function(t){var n=o.call(t,a),e=t[a];try{t[a]=void 0;var i=!0}catch(t){}var r=s.call(t);return i&&(n?t[a]=e:delete t[a]),r}},function(t,n){var e=Object.prototype.toString;t.exports=function(t){return e.call(t)}},function(t,n){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,n,e){"use strict";(function(n){
/*! art-template@runtime | https://github.com/aui/art-template */
var e="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n?n:{},i=Object.create(e),r=/["&'<>]/;i.$escape=function(t){return function(t){var n=""+t,e=r.exec(n);if(!e)return t;var i="",o=void 0,s=void 0,a=void 0;for(o=e.index,s=0;o<n.length;o++){switch(n.charCodeAt(o)){case 34:a="&#34;";break;case 38:a="&#38;";break;case 39:a="&#39;";break;case 60:a="&#60;";break;case 62:a="&#62;";break;default:continue}s!==o&&(i+=n.substring(s,o)),s=o+1,i+=a}return s!==o?i+n.substring(s,o):i}(function t(n){"string"!=typeof n&&(n=null==n?"":"function"==typeof n?t(n.call(n)):JSON.stringify(n));return n}(t))},i.$each=function(t,n){if(Array.isArray(t))for(var e=0,i=t.length;e<i;e++)n(t[e],e);else for(var r in t)n(t[r],r)},t.exports=i}).call(this,e(3))},function(t,n,e){},function(t,n,e){"use strict";e.r(n);var i=e(0),r=e.n(i),o=e(6),s=e.n(o),a={API_BASE_URL:"https://bm.weajs.com/api/",DB_BASE_URL:"https://m.douban.com/movie/subject/"},c=e(7),u=e.n(c),l=e(8),f=e.n(l),d=function(){function t(t){var n=t.type,e=t.selector,i=t.secret,o=t.limit,s=t.skeletonNum,c=t.noMoreText,u=t.fields,l=void 0===u?[]:u;this.apiUrl=""+a.API_BASE_URL+(n||"movies"),this.noMoreText=c||"",this.skeletonNum=s||5,this.page=1,this.secret=i,this.limit=o||15,this.fields=l,this.isLoading=!1,this.$container=r()(e),this.$window=r()(window),this.getData(),this.setViews(),this.bindScrollEvent()}var n=t.prototype;return n.setViews=function(){this.$container.append(u()({skeletons:Array.from({length:this.skeletonNum})})),this.$list=this.$container.find(".bmdb-list .bmdb-ul"),this.$loader=this.$container.find(".bmdb-loader")},n.bindScrollEvent=function(){var t=this;this.scrollFn=s()(function(){t.onScroll()},16),this.$window.on("scroll",this.scrollFn)},n.onScroll=function(){this.$window.scrollTop()+this.$window.height()+100>this.$loader.offset().top&&this.getData()},n.getData=function(){var t=this;this.isLoading||(this.isLoading=!0,r.a.ajax({url:this.apiUrl,data:{page:this.page,secret:this.secret,limit:this.limit,fields:this.fields.join(",")},dataType:"json"}).then(function(n){n.length<t.limit&&(t.setNoMoreDataView(),t.offScrollEvent()),t.render(n),t.page+=1,t.isLoading=!1}).catch(function(n){t.isLoading=!1,console.error("[BMDB]",n)}))},n.render=function(t){t=t.map(function(t){var n=Math.round(t.rating/2);return t.doubanUrl=""+a.DB_BASE_URL+t.doubanId,t.stars=Array.from({length:5}).map(function(t,e){return e+1<=n}),t.rating=t.rating.includes(".")?t.rating:t.rating+".0",t}),this.$list.append(f()({data:t}))},n.setNoMoreDataView=function(){this.$loader.text(this.noMoreText)},n.offScrollEvent=function(){this.$window.off("scroll",this.scrollFn)},t}();e(18),n.default=d}]).default});
//# sourceMappingURL=Bmdb.min.js.map